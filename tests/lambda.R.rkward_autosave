data(yaish)

# Last layer omitted because of low frequencies
yaish <- yaish[,,-7]

um <- unidiff(yaish, reference="marginal.weighted")
uu <- unidiff(yaish, reference="uniform.weighted")
un <- unidiff(yaish, reference="unweighted")

lm <- lambda(fitted(um)[,,1], "marginal",
             prop.table(margin.table(yaish, 1)),
             prop.table(margin.table(yaish, 2)))
lu <- lambda(fitted(uu)[,,1], "uniform")
ln <- lambda(fitted(un)[,,1], "none")

sqrt(sum(lambda2(fitted(um)[,,1])^2 * prop.table(margin.table(yaish, 1)) %o% prop.table(margin.table(yaish, 2))))

stopifnot(all.equal(lm, um$unidiff$association))
stopifnot(all.equal(lu, uu$unidiff$association))
stopifnot(all.equal(ln, un$unidiff$association))

rcm <- rc(fitted(um)[,,1], weighting="marginal")
rcu <- rc(fitted(uu)[,,1], weighting="uniform")
rcn <- rc(fitted(un)[,,1], weighting="none")

stopifnot(all.equal(lm, um$unidiff$association, sqrt(sum(rcm$assoc$phi^2))))
